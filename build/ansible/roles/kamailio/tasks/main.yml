---
# Kamailio
- name: Update Kamailio configuration
  template:
    src: "{{sourcedir}}/platform/kamailio/{{item}}"
    dest: "{{destinationdir}}/platform/kamailio/{{item}}"
    owner: root
    group: root
    mode: 0754
  with_items:
    - kamailio.cfg

- name: update a symbolic link for kamailio config directory
  file:
    src: "{{rundir}}/platform/kamailio"
    dest: /usr/local/etc/kamailio
    force: true
    state: link

- name: Copy a kamailio.service to systemd
  copy:
    src: kamailio.service
    dest: /etc/systemd/system/kamailio.service
    owner: root
    group: root
    mode: 0754

- name: handle kamailio daemon 
  debug: 
    msg: "kamailio will be {{fire_daemon}}"
  changed_when: fire_daemon != "idempotent"
  notify: 
    - restart kamailio
  when: fire_daemon is defined